#!/bin/sh

. config/options

$SCRIPTS/install ccache
$SCRIPTS/build gmp
$SCRIPTS/build ppl

setup_toolchain host

cd $BUILD/$1*

mkdir -p objdir
cd objdir

LDFLAGS="-Wl,-rpath,$ROOT/$TOOLCHAIN/lib" \
../configure --host=$HOST_NAME \
             --build=$HOST_NAME \
             --target=$TARGET_NAME \
             --prefix=$ROOT/$TOOLCHAIN \
             --disable-shared \
             --enable-static \
             --with-bits=gmp \
             --with-gmp="$ROOT/$TOOLCHAIN" \
             --with-ppl="$ROOT/$TOOLCHAIN" \

make libcloog.la

mkdir -p $ROOT/$TOOLCHAIN/lib
  cp -PR .libs/libcloog.a $ROOT/$TOOLCHAIN/lib

mkdir -p $ROOT/$TOOLCHAIN/include/cloog
  cp -PR include/cloog/*.h $ROOT/$TOOLCHAIN/include/cloog

# use the follow if cloog-ppl is fixed for use with gmp-5.0
# make
# make check #