From ecc1de83443ec23f4e637f6bdf4ac8c054492594 Mon Sep 17 00:00:00 2001
From: Stefan Saraev <stefan@saraev.ca>
Date: Sat, 28 Sep 2013 17:45:39 +0300
Subject: [PATCH] fix dns with broken routers

BP https://abf.rosalinux.ru/grendizer/eglibc/raw/master/eglibc-mandriva-fix-dns-with-broken-routers.patch
---
 sysdeps/unix/sysv/linux/check_pf.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/sysdeps/unix/sysv/linux/check_pf.c b/sysdeps/unix/sysv/linux/check_pf.c
index 34c2146..be7de0d 100644
--- a/sysdeps/unix/sysv/linux/check_pf.c
+++ b/sysdeps/unix/sysv/linux/check_pf.c
@@ -234,7 +234,8 @@ make_request (int fd, pid_t pid)
 		    }
 		  else
 		    {
-		      if (!IN6_IS_ADDR_LOOPBACK (address))
+		      if (!IN6_IS_ADDR_LOOPBACK (address) &&
+			  !IN6_IS_ADDR_LINKLOCAL (address))
 			seen_ipv6 = true;
 		    }
 		}
-- 
1.7.2.5

