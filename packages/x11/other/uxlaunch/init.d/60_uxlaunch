# starting uxlaunch
#
# runlevels: openelec

progress "starting uxlaunch"

  UX_USER="openelec"
  UX_TTY="1"
  XORG_CONF="/etc/X11/xorg.conf"
  XORG_NVIDIA_CONF="/etc/X11/xorg-nvidia.conf"

  if [ "$START_MRXVT" = "yes" -a -f /usr/bin/mrxvt-session ]; then
    UX_SESSION="/usr/bin/mrxvt-session"
  else
    UX_SESSION="/usr/bin/xbmc-session"
  fi

  UX_ARG="-u $UX_USER -t $UX_TTY -s $UX_SESSION"
  [ "$DEBUG" = "yes" ] && UX_ARG="$UX_ARG -v"

progress "creating directories needed for Xorg"

  $IONICE mkdir -p /var/cache/xkb
  $IONICE mkdir -p /var/lib
  $IONICE mkdir -m 1777 -p /tmp/.ICE-unix
  $IONICE chown root:root /tmp/.ICE-unix

  if lspci -n | grep 0300 | grep -q 10de; then
    $IONICE ln -sf /usr/lib/libGL_nvidia.so.1 /var/lib/libGL.so
    $IONICE ln -sf /usr/lib/xorg/modules/extensions/libglx_nvidia.so /var/lib/libglx.so
#    UX_ARG="$UX_ARG -c $XORG_NVIDIA_CONF"
  else
    $IONICE ln -sf /usr/lib/libGL_mesa.so.1 /var/lib/libGL.so
    $IONICE ln -sf /usr/lib/xorg/modules/extensions/libglx_mesa.so /var/lib/libglx.so
#    UX_ARG="$UX_ARG -c $XORG_CONF"
  fi

progress "starting xsession"

  uxlaunch $UX_ARG > /dev/null 2>&1