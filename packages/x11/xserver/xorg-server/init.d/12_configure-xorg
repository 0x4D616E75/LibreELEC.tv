# configure X.Org video settings
#
# runlevels: openelec, text, debug

if lspci -n | grep 0300 | grep -q 10de; then

  progress "Found nVidia card, loading NVidia driver"
    $IONICE modprobe nvidia &

  progress "Found nVidia card, enabling NVIDIA GLX as requested"
    $IONICE mkdir -p /var/lib
    $IONICE ln -sf /usr/lib/libGL_nvidia.so.1 /var/lib/libGL.so
    $IONICE ln -sf /usr/lib/xorg/modules/extensions/libglx_nvidia.so /var/lib/libglx.so

else

  progress "Not found nVidia card, enabling Mesa GLX as requested"
    $IONICE mkdir -p /var/lib
    $IONICE ln -sf /usr/lib/libGL_mesa.so.1 /var/lib/libGL.so
    $IONICE ln -sf /usr/lib/xorg/modules/extensions/libglx_mesa.so /var/lib/libglx.so

fi

# Make some needed directorys
  $IONICE mkdir -p /var/cache/xkb
  $IONICE mkdir -m 1777 -p /tmp/.ICE-unix
  $IONICE chown root:root /tmp/.ICE-unix
