#!/bin/sh

. config/options

XORG_SRC="$BUILD/$1*/hw/xfree86"

$SCRIPTS/build toolchain

$SCRIPTS/build xf86driproto
$SCRIPTS/build randrproto
$SCRIPTS/build renderproto
$SCRIPTS/build scrnsaverproto
$SCRIPTS/build resourceproto
$SCRIPTS/build videoproto
$SCRIPTS/build compositeproto
$SCRIPTS/build xineramaproto
$SCRIPTS/build xf86dgaproto
$SCRIPTS/build xf86miscproto
$SCRIPTS/build libpciaccess
$SCRIPTS/build libX11
$SCRIPTS/build libXfont
$SCRIPTS/build libxkbfile
$SCRIPTS/build libXv
$SCRIPTS/build libXvMC
$SCRIPTS/build libdrm
$SCRIPTS/build Mesa
$SCRIPTS/build openssl
$SCRIPTS/build freetype
$SCRIPTS/build libfontenc
$SCRIPTS/build pixman
$SCRIPTS/build fontsproto
#$SCRIPTS/build fontcacheproto
$SCRIPTS/build dbus
$SCRIPTS/build hal

#fixesproto
#damageproto
#xcmiscproto
#xextproto
#xproto
#xtrans
#bigreqsproto
#inputproto
#kbproto
#xineramaproto

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --disable-static \
            --enable-shared \
            --disable-werror \
            --disable-debug \
            --disable-builddocs \
            --enable-largefile \
            --disable-builtin-fonts \
            --enable-install-libxf86config \
            --enable-aiglx \
            --disable-glx-tls \
            --enable-registry \
            --enable-composite \
            --disable-null-root-cursor \
            --enable-mitshm \
            --disable-xres \
            --disable-xtrap \
            --disable-record \
            --enable-xv \
            --enable-xvmc \
            --enable-dga \
            --disable-screensaver \
            --disable-xdmcp \
            --disable-xdm-auth-1 \
            --enable-glx \
            --enable-dri \
            --disable-dri2 \
            --enable-xinerama \
            --enable-xf86vidmode \
            --enable-xf86misc \
            --disable-xace \
            --disable-xcsecurity \
            --disable-appgroup \
            --disable-xcalibrate \
            --disable-tslib \
            --disable-xevie \
            --disable-cup \
            --disable-evi \
            --disable-multibuffer \
            --disable-fontcache \
            --enable-dbe \
            --disable-xf86bigfont \
            --disable-dpms \
            --enable-config-dbus \
            --enable-config-hal \
            --enable-xfree86-utils \
            --enable-xorg \
            --disable-dmx \
            --disable-xvfb \
            --disable-xnest \
            --disable-xquartz \
            --disable-x11app \
            --disable-xwin \
            --disable-xprint \
            --disable-xgl \
            --disable-xglx \
            --disable-xegl \
            --disable-mfb \
            --disable-cfb \
            --disable-afb \
            --disable-kdrive \
            --disable-xephyr \
            --disable-xsdl \
            --disable-xfake \
            --disable-xfbdev \
            --disable-kdrive-vesa \
            --disable-freetype \
            --disable-install-setuid \
            --disable-secure-rpc \
            --disable-xorgcfg \
            --enable-kbd_mode \
            --disable-ipv6 \
            --with-gnu-ld \
            --with-os-vendor="OpenELEC" \
            --with-mesa-source=`ls -d $ROOT/$BUILD/Mesa*` \
            --with-module-dir=$XORG_PATH_MODULES \
            --with-xkb-path=$XORG_PATH_XKB \
            --with-xkb-output=$XORG_PATH_XKB_OUTPUT \
            --with-log-dir=/var/log \
            --with-dri-driver-path=$XORG_PATH_DRI \
            --with-fontdir=$XORG_PATH_FONTS \
            --with-rgb-path=$XORG_PATH_RGB \
            --with-default-font-path="$XORG_PATH_FONTS/misc"

#            --enable-unix-transport \
#            --disable-tcp-transport \
#            --disable-local-transport \

make

$STRIP hw/xfree86/Xorg
$STRIP hw/xfree86/utils/gtf/gtf
$STRIP hw/xfree86/shadowfb/.libs/libshadowfb.so
$STRIP hw/xfree86/dixmods/.libs/*.so
$STRIP hw/xfree86/vbe/.libs/libvbe.so
$STRIP hw/xfree86/int10/.libs/libint10.so
$STRIP hw/xfree86/exa/.libs/libexa.so
$STRIP hw/xfree86/vgahw/.libs/libvgahw.so
$STRIP hw/xfree86/xaa/.libs/libxaa.so
$STRIP hw/xfree86/xf8_16bpp/.libs/libxf8_16bpp.so
$STRIP hw/xfree86/dixmods/extmod/.libs/libextmod.so
$STRIP hw/xfree86/dri/.libs/libdri.so
$STRIP hw/xfree86/fbdevhw/.libs/libfbdevhw.so
$STRIP hw/xfree86/i2c/.libs/*_drv.so

make DESTDIR=$SYSROOT_PREFIX install
