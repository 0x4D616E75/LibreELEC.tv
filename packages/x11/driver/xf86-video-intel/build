#!/bin/sh

. config/options $1

$SCRIPTS/build toolchain
$SCRIPTS/build util-macros
$SCRIPTS/build fontsproto
$SCRIPTS/build udev
$SCRIPTS/build xorg-server

xorg_drv_configure_prepend

# ensure we dont use size optimization.
  CFLAGS=`echo $CFLAGS | sed -e "s|-Os|-O3|"`
  CXXFLAGS=`echo $CXXFLAGS | sed -e "s|-Os|-O3|"`

PKG_CONFIG="$PKG_CONFIG --define-variable=sdkdir=$SYSROOT_PREFIX/usr/include/xorg"
CFLAGS="$CFLAGS -I$SYSROOT_PREFIX/usr/include/xorg/"

cd $PKG_BUILD

$AUTORECONF

./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --enable-shared \
            --disable-static \
            --enable-dri \
            --enable-kms-only \
            --disable-xvmc \
            --with-xorg-module-dir=$XORG_PATH_MODULES

make

$MAKEINSTALL
