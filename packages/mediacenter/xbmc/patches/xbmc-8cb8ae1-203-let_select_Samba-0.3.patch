diff -Naur xbmc-8cb8ae1/configure.in xbmc-8cb8ae1.patch/configure.in
--- xbmc-8cb8ae1/configure.in	2011-09-14 19:15:24.254033004 +0200
+++ xbmc-8cb8ae1.patch/configure.in	2011-09-15 07:07:13.269071939 +0200
@@ -111,6 +111,7 @@
 libnfs_disabled="== NFS support disabled. =="
 libafpclient_not_found="== Could not find libafpclient. AFP support disabled. =="
 libafpclient_disabled="== AFP support disabled. =="
+samba_disabled="== SAMBA support disabled. =="
 alsa_not_found="== Could not find ALSA. ALSA support disabled. =="
 dbus_not_found="== Could not find DBUS. DBUS support disabled. =="
 
@@ -270,6 +271,12 @@
   [use_librtmp=$enableval],
   [use_librtmp=auto])
 
+AC_ARG_ENABLE([samba],
+  [AS_HELP_STRING([--disable-samba],
+  [disable SAMBA support (default is enabled)])],
+  [use_samba=$enableval],
+  [use_samba=yes])
+
 AC_ARG_ENABLE([nfs],
   [AS_HELP_STRING([--enable-nfs],
   [enable NFS support via libnfs (default is auto)])],
@@ -655,7 +662,6 @@
 AC_CHECK_LIB([ssl],         [main],, AC_MSG_ERROR($missing_library))
 AC_CHECK_LIB([mysqlclient], [main],, AC_MSG_ERROR($missing_library))
 AC_CHECK_LIB([ssh],         [sftp_tell64],, AC_MSG_RESULT([Could not find suitable version of libssh]))
-AC_CHECK_LIB([smbclient],   [main],, AC_MSG_ERROR($missing_library))
 AC_CHECK_LIB([bluetooth],   [hci_devid],, AC_MSG_RESULT([Could not find suitable version of libbluetooth]))
 AC_CHECK_LIB([yajl],        [main],, AC_MSG_ERROR($missing_library))
 
@@ -942,6 +948,18 @@
   AC_MSG_NOTICE($librtmp_disabled)
 fi
 
+# samba
+if test "x$use_samba" != "xno"; then
+  AC_CHECK_LIB([smbclient], [main],,
+    use_samba=no;AC_MSG_ERROR($missing_library))
+else
+  AC_MSG_RESULT($samba_disabled)
+fi
+
+if test "x$use_samba" != "xno"; then
+  AC_DEFINE([HAVE_LIBSMBCLIENT], [1], [Define to 1 if you have Samba installed])
+fi
+
 # libnfs
 if test "$use_libnfs" != "no"; then
   AC_CHECK_HEADERS([nfsc/libnfs.h],,
@@ -1563,6 +1581,12 @@
   final_message="$final_message\n  libRTMP support:\tNo"
 fi
 
+if test "x$use_samba" != "xno"; then
+  final_message="$final_message\n  libsmbclient support:\tYes"
+else
+  final_message="$final_message\n  libsmbclient support:\tNo"
+fi
+
 if test "$use_libnfs" != "no"; then
   final_message="$final_message\n  libnfs support:\tYes"
 else
diff -Naur xbmc-8cb8ae1/xbmc/dialogs/GUIDialogMediaSource.cpp xbmc-8cb8ae1.patch/xbmc/dialogs/GUIDialogMediaSource.cpp
--- xbmc-8cb8ae1/xbmc/dialogs/GUIDialogMediaSource.cpp	2011-09-13 05:37:49.000000000 +0200
+++ xbmc-8cb8ae1.patch/xbmc/dialogs/GUIDialogMediaSource.cpp	2011-09-14 19:18:27.456425046 +0200
@@ -237,9 +237,11 @@
     share1.m_ignore = true;
     extraShares.push_back(share1);
 
+#ifdef HAS_FILESYSTEM_SMB
     share1.strPath = "smb://";
     share1.strName = g_localizeStrings.Get(20171);
     extraShares.push_back(share1);
+#endif
 
 #ifdef HAS_FILESYSTEM_NFS
     share1.strPath = "nfs://";
@@ -285,9 +287,11 @@
     share1.strName = "ReplayTV Devices";
     extraShares.push_back(share1);
 
+#ifdef HAS_FILESYSTEM_SMB
     share1.strPath = "smb://";
     share1.strName = g_localizeStrings.Get(20171);
     extraShares.push_back(share1);
+#endif
 
 #ifdef HAS_FILESYSTEM_NFS
     share1.strPath = "nfs://";
@@ -322,9 +326,11 @@
       extraShares.push_back(share1);
     }
 
+#ifdef HAS_FILESYSTEM_SMB
     share1.strPath = "smb://";
     share1.strName = g_localizeStrings.Get(20171);
     extraShares.push_back(share1);
+#endif
 
 #ifdef HAS_FILESYSTEM_NFS
     share1.strPath = "nfs://";
diff -Naur xbmc-8cb8ae1/xbmc/network/GUIDialogNetworkSetup.cpp xbmc-8cb8ae1.patch/xbmc/network/GUIDialogNetworkSetup.cpp
--- xbmc-8cb8ae1/xbmc/network/GUIDialogNetworkSetup.cpp	2011-09-13 05:37:54.000000000 +0200
+++ xbmc-8cb8ae1.patch/xbmc/network/GUIDialogNetworkSetup.cpp	2011-09-14 19:18:45.745663929 +0200
@@ -127,7 +127,9 @@
     return;
 
   pSpin->Clear();
+#ifdef HAS_FILESYSTEM_SMB
   pSpin->AddLabel(g_localizeStrings.Get(20171), NET_PROTOCOL_SMB);
+#endif
   pSpin->AddLabel(g_localizeStrings.Get(20256), NET_PROTOCOL_HTSP);
   pSpin->AddLabel(g_localizeStrings.Get(20257), NET_PROTOCOL_VTP);
   pSpin->AddLabel(g_localizeStrings.Get(20258), NET_PROTOCOL_MYTH);
diff -Naur xbmc-8cb8ae1/xbmc/network/ZeroconfBrowser.cpp xbmc-8cb8ae1.patch/xbmc/network/ZeroconfBrowser.cpp
--- xbmc-8cb8ae1/xbmc/network/ZeroconfBrowser.cpp	2011-09-13 05:37:53.000000000 +0200
+++ xbmc-8cb8ae1.patch/xbmc/network/ZeroconfBrowser.cpp	2011-09-15 10:11:24.049894106 +0200
@@ -54,7 +54,9 @@
 
 CZeroconfBrowser::CZeroconfBrowser():mp_crit_sec(new CCriticalSection),m_started(false)
 {
+#ifdef HAS_FILESYSTEM_SMB
   AddServiceType("_smb._tcp.");
+#endif
   AddServiceType("_ftp._tcp.");
   AddServiceType("_htsp._tcp.");
   AddServiceType("_daap._tcp.");
diff -Naur xbmc-8cb8ae1/xbmc/system.h xbmc-8cb8ae1.patch/xbmc/system.h
--- xbmc-8cb8ae1/xbmc/system.h	2011-09-13 05:37:53.000000000 +0200
+++ xbmc-8cb8ae1.patch/xbmc/system.h	2011-09-14 19:34:09.853626990 +0200
@@ -52,7 +52,6 @@
 #endif
 
 #define HAS_FILESYSTEM
-#define HAS_FILESYSTEM_SMB
 #define HAS_FILESYSTEM_CDDA
 #define HAS_FILESYSTEM_RTV
 #define HAS_FILESYSTEM_DAAP
@@ -60,6 +59,10 @@
 #define HAS_FILESYSTEM_VTP
 #define HAS_FILESYSTEM_HTSP
 
+#ifdef HAVE_LIBSMBCLIENT
+  #define HAS_FILESYSTEM_SMB
+#endif
+
 #ifdef HAVE_LIBNFS
   #define HAS_FILESYSTEM_NFS
 #endif
@@ -99,6 +102,7 @@
 #define HAVE_LIBBLURAY
 #define HAS_ASAP_CODEC
 #define HAVE_YAJL_YAJL_VERSION_H
+#define HAS_FILESYSTEM_SMB
 #define HAS_FILESYSTEM_NFS
 #endif
 
