#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build libpthread-stubs
$SCRIPTS/build udev

get_graphicdrivers

for drv in $DRM_DRIVERS; do
  [ $drv = radeon ] && \
    DRM_CONFIG="$DRM_CONFIG --enable-radeon-experimental-api"

  [ $drv = nouveau ] && \
    DRM_CONFIG="$DRM_CONFIG --enable-nouveau-experimental-api"
done

export LIBUDEV_CFLAGS="-I`ls -d $ROOT/$BUILD/udev*`"
export LIBUDEV_LIBS="-I`ls -d $ROOT/$BUILD/udev*`"

cd $PKG_BUILD
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --disable-static \
            --enable-shared \
            --enable-udev \
            --enable-largefile \
            $DRM_CONFIG \

make

$MAKEINSTALL
