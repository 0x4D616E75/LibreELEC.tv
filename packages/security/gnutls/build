#!/bin/sh

. config/options $1

# gnutls fails compiling with LTO support
  strip_lto

cd $PKG_BUILD

cd lib
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-static \
            --enable-shared \
            --with-included-libtasn1 \
            --with-lzo \
            --with-libz-prefix="$SYSROOT_PREFIX/usr" \
            --with-libgcrypt-prefix="$SYSROOT_PREFIX/usr" \
            --disable-nls \
            --with-gnu-ld

#            --enable-cryptodev \ # TODO: add later

make
$MAKEINSTALL

cd ../libextra
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-static \
            --enable-shared \
            --with-included-libtasn1 \
            --with-lzo \
            --with-libgcrypt-prefix="$SYSROOT_PREFIX/usr" \
            --with-gnu-ld

#            --enable-openssl-compatibility \
#            --enable-cryptodev \ # TODO: add later

make
$MAKEINSTALL
