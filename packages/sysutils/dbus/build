#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build expat
$SCRIPTS/build libX11

# dbus fails to compile with GCC 4.5.0's link time optimization.
  CFLAGS=`echo $CFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`
  CXXFLAGS=`echo $CXXFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`
  LDFLAGS=`echo $LDFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`

export ac_cv_have_abstract_sockets=yes

cd $PKG_BUILD

mkdir -p .build-target
cd .build-target

../configure --host=$TARGET_NAME \
             --build=$HOST_NAME \
             --prefix=/usr \
             --sysconfdir=/etc \
             --libexecdir=/usr/lib/dbus \
             --localstatedir=/var \
             --disable-static \
             --enable-shared \
             --disable-tests \
             --disable-ansi \
             --disable-verbose-mode \
             --disable-asserts \
             --disable-checks \
             --disable-xml-docs \
             --disable-doxygen-docs \
             --disable-gcov  \
             --enable-abstract-sockets \
             --disable-selinux \
             --disable-libaudit \
             --disable-dnotify \
             --enable-inotify \
             --with-xml=expat \
             --with-x \
             --with-dbus-user=dbus \

make

$MAKEINSTALL
