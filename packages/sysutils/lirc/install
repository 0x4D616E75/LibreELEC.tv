#!/bin/sh

. config/options

$SCRIPTS/install linux

PKG_DIR=`find $PACKAGES -type d -name $1`
VER=`ls $BUILD/linux*/modules/lib/modules`

mkdir -p $INSTALL/usr/sbin
  cp $PKG_BUILD/daemons/lircd $INSTALL/usr/sbin
  cp $PKG_BUILD/daemons/lircmd $INSTALL/usr/sbin # do we need this?

mkdir -p $INSTALL/usr/bin
  cp $PKG_BUILD/tools/irpty $INSTALL/usr/bin

mkdir -p $INSTALL/etc
  cp $PKG_DIR/config/lircd_$REMOTE.conf $INSTALL/etc/lircd.conf
  cp $PKG_DIR/config/config_$RECEIVER $INSTALL/etc/lirc.conf

mkdir -p $INSTALL/lib/modules/$VER/lirc
  cp $PKG_BUILD/drivers/*/*.ko $INSTALL/lib/modules/$VER/lirc

for MOD in `find $INSTALL/lib/modules/$VER/lirc -name *.ko`; do
  $STRIP --strip-debug $MOD
done

$ROOT/$TOOLCHAIN/bin/depmod -b $INSTALL -v $VER > /dev/null
for i in `ls $INSTALL/lib/modules/*/modules.* | grep -v modules.dep | grep -v modules.alias | grep -v modules.symbols`; do
  rm -f $i
done

if [ "$DEVTOOLS" = yes ]; then
  mkdir -p $INSTALL/usr/bin
    cp $PKG_BUILD/tools/ircat $INSTALL/usr/bin # do we need this?
    cp $PKG_BUILD/tools/irexec $INSTALL/usr/bin # do we need this?
    cp $PKG_BUILD/tools/irsend $INSTALL/usr/bin
    cp $PKG_BUILD/tools/irw $INSTALL/usr/bin
    cp $PKG_BUILD/tools/lircrcd $INSTALL/usr/bin # do we need this?
    cp $PKG_BUILD/tools/mode2 $INSTALL/usr/bin
    cp $PKG_BUILD/daemons/irrecord $INSTALL/usr/bin
    cp $PKG_BUILD/tools/irsend $INSTALL/usr/bin # do we need this?
fi
