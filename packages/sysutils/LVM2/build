#!/bin/sh

. config/options

$SCRIPTS/build toolchain

# LVM2 fails to compile with GCC 4.5.0's link time optimization.
  CFLAGS=`echo $CFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`
  CXXFLAGS=`echo $CXXFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`
  LDFLAGS=`echo $LDFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`

cd $BUILD/$1*
ac_cv_func_malloc_0_nonnull=yes \
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --disable-lvm1_fallback \
            --disable-static_link \
            --disable-readline \
            --enable-realtime \
            --enable-debug \
            --disable-profiling \
            --enable-devmapper \
            --disable-compat \
            --enable-o_direct \
            --enable-applib \
            --enable-cmdlib \
            --enable-pkgconfig \
            --enable-fsadm \
            --disable-dmeventd \
            --disable-selinux \
            --disable-nls \

make

$MAKEINSTALL
