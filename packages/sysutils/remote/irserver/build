#!/bin/sh

. config/options

$SCRIPTS/build toolchain

# irserver fails to compile with GCC 4.5.0's link time optimization.
  CFLAGS=`echo $CFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`
  CXXFLAGS=`echo $CXXFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`
  LDFLAGS=`echo $LDFLAGS | sed -e "s|-flto||" -e "s|-fuse-linker-plugin||" -e "s|-fwhole-program||"`

cd $PKG_BUILD

[ $TARGET_ARCH = i386 ] && make CC=$TARGET_CC irserver
[ $TARGET_ARCH = x86_64 ] && make CC=$TARGET_CC irserver64
[ $TARGET_ARCH = arm ] && make CC=$TARGET_CC irserver_arm

$STRIP $1*