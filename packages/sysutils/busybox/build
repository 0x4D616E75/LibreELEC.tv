#!/bin/sh

. config/options

$SCRIPTS/build toolchain

PKG_DIR=`find $PACKAGES -type d -name $1`

if [ -f $PROJECT_DIR/$PROJECT/$1/$1.conf ]; then
  BUSYBOX_CFG_FILE=$PROJECT_DIR/$PROJECT/$1/$1.conf
else
  BUSYBOX_CFG_FILE=$ROOT/$PKG_DIR/config/$1.conf
fi

cd $PKG_BUILD
# Build Busybox for initramfs
  make distclean
  cp $ROOT/$PKG_DIR/config/$1-initramfs.conf .config
  [ -n "$TIMEZONE" ] && sed -i -e 's/^# CONFIG_HWCLOCK .*$/CONFIG_HWCLOCK=yes/g' -e 's/^# CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS .*/CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS=yes/g' $BUSYBOX/.config
  make oldconfig

  ARCH=$TARGET_ARCH make install

# Build Busybox for system
  make distclean
  cp $BUSYBOX_CFG_FILE .config
  make oldconfig

  ARCH=$TARGET_ARCH make install
