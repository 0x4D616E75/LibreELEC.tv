#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build gettext
$SCRIPTS/build pciutils
$SCRIPTS/build udev
$SCRIPTS/build expat
$SCRIPTS/build glib
$SCRIPTS/build dbus
$SCRIPTS/build dbus-glib
$SCRIPTS/build util-linux-ng

export CFLAGS="$CFLAGS -I$SYSROOT_PREFIX/usr/include"
export LDFLAGS="$LDFLAGS -L$SYSROOT_PREFIX/usr/lib"

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --datadir=/usr/share \
            --localstatedir=/var \
            --disable-static \
            --enable-shared \
            --disable-docbook-docs \
            --disable-man-pages \
            --disable-gtk-doc \
            --enable-largefile \
            --enable-pci \
            --enable-pci-ids \
            --with-libpci \
            --enable-usb \
            --enable-usb-ids \
            --enable-pnp-ids \
            --disable-apm \
            --disable-pmu \
            --disable-acpi \
            --disable-acpi-acpid \
            --disable-acpi-proc \
            --disable-acpi-ibm \
            --disable-acpi-toshiba \
            --disable-parted \
            --disable-smbios \
            --disable-console-kit \
            --disable-policy-kit \
            --disable-acl-management \
            --disable-umount-helper \
            --disable-sonypic \
            --with-pci-ids=/usr/share \
            --with-usb-ids=/usr/share \
            --with-socket-dir=/var/run/dbus \
            --with-hal-user=haldaemon \
            --with-hal-group=haldaemon \
            --with-backend=linux \
            --with-keymaps \
            --with-deprecated-keys \
            --with-dbus-sys=/etc/dbus-1 \
            --without-macbookpro \
            --without-macbook \
            --without-imac \
            --without-omap \
            --with-cpufreq \
            --without-usb-csr \
            --without-dell-backlight \

#            --with-pid-file=/var/run/hald/hald.pid \

make

$STRIP libhal/.libs/libhal.so*
$STRIP libhal-storage/.libs/libhal-storage.so*

make -C libhal DESTDIR=$SYSROOT_PREFIX install
make -C libhal-storage DESTDIR=$SYSROOT_PREFIX install
make DESTDIR=$SYSROOT_PREFIX install-pkgconfigDATA
