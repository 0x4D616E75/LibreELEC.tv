#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build glib

cd $PKG_BUILD
LDFLAGS="$LDFLAGS -I$SYSROOT_PREFIX/usr/include/glib-2.0" \
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --sbindir=/sbin \
            --libexecdir=/lib/udev \
            --localstatedir=/var \
            --disable-silent-rules \
            --disable-static \
            --enable-shared \
            --disable-gtk-doc \
            --disable-debug \
            --enable-logging \
            --disable-extras \
            --disable-introspection \
            --with-gnu-ld \

make
make CFLAGS="-I$SYSROOT_PREFIX/usr/include/glib-2.0" extras/gudev/libgudev-1.0.la


$STRIP udev/udevd
$STRIP udev/udevadm

$MAKEINSTALL

mkdir -p $SYSROOT_PREFIX/usr/lib
  cp -PR extras/gudev/.libs/*.a $SYSROOT_PREFIX/usr/lib

mkdir -p $SYSROOT_PREFIX/usr/lib/pkgconfig
  cp -PR extras/gudev/*.pc $SYSROOT_PREFIX/usr/lib/pkgconfig

mkdir -p $SYSROOT_PREFIX/usr/include/gudev
  cp -PR extras/gudev/*.h $SYSROOT_PREFIX/usr/include/gudev
