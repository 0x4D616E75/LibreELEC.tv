#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build expat
$SCRIPTS/build libX11

export ac_cv_have_abstract_sockets=set

export CFLAGS="$CFLAGS -I$LIB_PREFIX/include"
export LDFLAGS="$LDFLAGS -L$LIB_PREFIX/lib"

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-static \
            --enable-shared \
            --disable-tests \
            --disable-ansi \
            --disable-verbose-mode \
            --disable-asserts \
            --disable-checks \
            --disable-xml-docs \
            --disable-doxygen-docs \
            --disable-gcov  \
            --enable-abstract-sockets \
            --disable-selinux \
            --disable-libaudit \
            --disable-dnotify \
            --enable-inotify \
            --with-xml=expat \
            --with-x \
            --with-dbus-user=dbus \

#            --with-session-socket-dir=/var/run/dbus \
#            --with-test-socket-dir=/var/run/dbus \
#            --with-system-pid-file=/var/run/dbus/pid \
#            --with-system-socket=/var/run/dbus/system_bus_socket \

make

$STRIP dbus/.libs/libdbus-1.so*

make -C dbus DESTDIR=$SYSROOT_PREFIX install
make DESTDIR=$SYSROOT_PREFIX install-pkgconfigDATA

