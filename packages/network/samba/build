#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build libiconv

#export samba_cv_HAVE_GETTIMEOFDAY_TZ=yes
#export samba_cv_USE_SETEUID=yes
#export samba_cv_HAVE_IFACE_IFCONF=yes
#export SMB_BUILD_CC_NEGATIVE_ENUM_VALUES=no
#export samba_cv_have_longlong=yes

export samba_cv_CC_NEGATIVE_ENUM_VALUES=no

cd $PKG_BUILD/source3
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --localstatedir=/var \
            --with-configdir=/etc \
            --with-privatedir=/etc \
            --disable-pie \
            --disable-cups \
            --without-cifsmount \
            --without-ldap \
            --without-winbind \
            --with-included-popt \
            --with-libsmbclient \
            --without-ads \
            --without-quotas \
            --without-sys-quotas \
            --with-syslog \
            --with-libiconv=$SYSROOT_PREFIX/usr \

make bin/smbtree \
     bin/libsmbclient.so \
     bin/smbd

mkdir -p $SYSROOT_PREFIX/usr/lib
  cp -PR bin/libsmbclient.so* $SYSROOT_PREFIX/usr/lib
  cp -PR bin/libtalloc.so* $SYSROOT_PREFIX/usr/lib
  cp -PR bin/libtdb.so* $SYSROOT_PREFIX/usr/lib

mkdir -p $SYSROOT_PREFIX/usr/include
  cp include/libsmbclient.h $SYSROOT_PREFIX/usr/include
#cp include/libmsrpc.h $SYSROOT_PREFIX/usr/include

mkdir -p $SYSROOT_PREFIX/usr/lib/pkgconfig
  cp pkgconfig/smbclient.pc $SYSROOT_PREFIX/usr/lib/pkgconfig
