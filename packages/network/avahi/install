#!/bin/sh

. config/options

$SCRIPTS/install expat
$SCRIPTS/install libdaemon
$SCRIPTS/install dbus
$SCRIPTS/install Python
$SCRIPTS/install dbus-python
$SCRIPTS/install pygtk

PKG_DIR=`find $PACKAGES -type d -name $1`
PYTHON_LIB_DIR=`ls -d $INSTALL/usr/lib/python*`

mkdir -p $INSTALL/usr/sbin
cp -PR $BUILD/$1*/avahi-autoipd/avahi-autoipd $INSTALL/usr/sbin
cp -PR $BUILD/$1*/avahi-daemon/.libs/avahi-daemon $INSTALL/usr/sbin
cp -PR $BUILD/$1*/avahi-dnsconfd/.libs/avahi-dnsconfd $INSTALL/usr/sbin

mkdir -p $INSTALL/usr/lib
cp -PR $BUILD/$1*/avahi-common/.libs/*.so* $INSTALL/usr/lib/
cp -PR $BUILD/$1*/avahi-core/.libs/*.so* $INSTALL/usr/lib/
rm -rf $INSTALL/usr/lib/libavahi*.so*T

mkdir -p $INSTALL/etc/avahi
cp -PR $BUILD/$1*/avahi-autoipd/avahi-autoipd.action $INSTALL/etc/avahi
cp -PR $BUILD/$1*/avahi-daemon/avahi-daemon.conf $INSTALL/etc/avahi

mkdir -p $INSTALL/etc/avahi/services
cp -PR $BUILD/$1*/avahi-daemon/sftp-ssh.service $INSTALL/etc/avahi/services
cp -PR $BUILD/$1*/avahi-daemon/ssh.service $INSTALL/etc/avahi/services

mkdir -p $INSTALL/etc/dbus-1/system.d
cp -PR $BUILD/$1*/avahi-daemon/avahi-dbus.conf $INSTALL/etc/dbus-1/system.d

mkdir -p $PYTHON_LIB_DIR/site-packages/avahi
cp $BUILD/$1*/avahi-python/avahi/*.pyc $PYTHON_LIB_DIR/site-packages/avahi

mkdir -p $INSTALL/usr/share/avahi
cp -PR $BUILD/$1*/service-type-database/service-types $INSTALL/usr/share/avahi
cp -PR $BUILD/$1*/avahi-daemon/avahi-service.dtd $INSTALL/usr/share/avahi

mkdir -p $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/ServiceTypeBrowser.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/HostNameResolver.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/EntryGroup.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/ServiceBrowser.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/Server.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/DomainBrowser.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/ServiceResolver.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/RecordBrowser.introspect $INSTALL/usr/share/avahi/introspection
cp -PR $BUILD/$1*/avahi-daemon/AddressResolver.introspect $INSTALL/usr/share/avahi/introspection

mkdir -p $INSTALL/usr/share/udhcpc
cp $PKG_DIR/scripts/udhcp-avahi.script $INSTALL/usr/share/udhcpc/default.script

