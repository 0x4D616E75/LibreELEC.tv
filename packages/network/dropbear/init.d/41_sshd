# start ssh server
#
# runlevels: openelec, text

(
  # Check for the Dropbear RSA key
    if [ ! -f /etc/dropbear/dropbear_rsa_host_key ] ; then
      progress "SSH: generating rsa key"

      $IONICE mkdir -p /etc/dropbear
      dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key > /dev/null 2>&1
    fi

  # Check for the Dropbear DSS key
    if [ ! -f /etc/dropbear/dropbear_dss_host_key ] ; then
      progress "SSH: generating dsa key"

      $IONICE mkdir -p /etc/dropbear
      dropbearkey -t dss -f /etc/dropbear/dropbear_dss_host_key > /dev/null 2>&1
    fi

  progress "Starting SSH Server"

  $IONICE mkdir -p /var/log
  $IONICE touch /var/log/lastlog
  $IONICE touch /var/log/wtmp

  dropbear -b /etc/issue -P /var/run/dropbear.pid

)&
