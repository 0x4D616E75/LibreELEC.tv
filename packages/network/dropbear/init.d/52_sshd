#!/bin/sh
#
# start telnet daemon
#
# runlevels: openelec, text, debug

. /etc/sysconfig

if test "$OE_START_SSHSERVER" = "yes" \
        -a -f /usr/bin/dropbearkey \
        -a -f /etc/issue ; then
  progress "Starting SSH Server"

  # Check for the Dropbear RSA key
    if [ ! -f /etc/dropbear/dropbear_rsa_host_key ] ; then
      progress "SSH: generating rsa key"

      mkdir -p /etc/dropbear
      /usr/bin/dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key > /dev/null 2>&1
    fi

  # Check for the Dropbear DSS key
    if [ ! -f /etc/dropbear/dropbear_dss_host_key ] ; then
      progress "SSH: generating dsa key"

      mkdir -p /etc/dropbear
      /usr/bin/dropbearkey -t dss -f /etc/dropbear/dropbear_dss_host_key > /dev/null 2>&1
    fi

  mkdir -p /var/log
  /usr/sbin/dropbear -b /etc/issue -P /var/run/dropbear.pid &
fi

exit 0
