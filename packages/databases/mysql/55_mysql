#!/bin/sh
#
# start mysql server
#
# runlevels: openelec, text, debug

. /etc/sysconfig

if test "$OE_MYSQL_START" = "yes" -a -f /etc/my.cnf; then

  if test ! -d $OE_MYSQL_DATADIR/mysql; then
    progress "prepare MySQL Systemdatabase"

    install -o mysqld -g mysqld -d $OE_MYSQL_DATADIR
    mysql_install_db \
      --datadir=$OE_MYSQL_DATADIR \
      --user=mysqld
  fi

  progress "Starting MySQL server"

  mysqld_safe \
    --datadir=$OE_MYSQL_DATADIR \
    --pid-file=$OE_MYSQL_PIDFILE \
    --log-warnings \
    --syslog &

  while [ -f $OE_MYSQL_PIDFILE ]; do
    sleep 10
  done

fi

exit 0
