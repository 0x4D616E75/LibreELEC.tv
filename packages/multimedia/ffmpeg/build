#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build faad2
$SCRIPTS/build zlib

FFMPEG_VDPAU="--disable-vdpau"
FFMPEG_VAAPI="--disable-vaapi"

if [ "$VDPAU" = yes ]; then
  $SCRIPTS/build libvdpau
  FFMPEG_VDPAU="--enable-vdpau"
fi

if [ "$VAAPI" = yes ]; then
  $SCRIPTS/build libva
  FFMPEG_VAAPI="--enable-vaapi"
fi

cd $PKG_BUILD/
./configure --prefix=/usr \
            --cpu=$TARGET_CPU \
            --arch=$TARGET_ARCH \
            --enable-cross-compile \
            --cross-prefix=$TARGET_PREFIX \
            --sysroot=$SYSROOT_PREFIX \
            --extra-cflags="$CFLAGS" \
            --disable-debug \
            --enable-stripping \
            --disable-static \
            --enable-shared \
            --enable-gpl \
            --enable-yasm \
            --disable-ffplay \
            --disable-ffserver \
            --disable-ffmpeg \
            --enable-postproc \
            --disable-avfilter \
            --disable-avfilter-lavf \
            --enable-pthreads \
            --disable-x11grab \
            --disable-ipv6 \
            --disable-mpegaudio-hp \
            --disable-gray \
            --enable-swscale-alpha \
            --enable-fastdiv \
            --enable-small \
            --enable-aandct \
            --enable-fft \
            --enable-golomb \
            --enable-mdct \
            --enable-rdft \
            $FFMPEG_VAAPI \
            $FFMPEG_VDPAU \
            --disable-encoders \
            --enable-decoders \
            --disable-decoder=mpeg_xvmc \
            --disable-muxers \
            --enable-demuxers \
            --enable-parsers \
            --enable-bsfs \
            --enable-protocols \
            --enable-protocol=http \
            --disable-indevs \
            --disable-outdevs \
            --disable-devices \
            --enable-filters \
            --disable-avisynth \
            --disable-bzlib \
            --disable-libopencore-amrnb \
            --disable-libopencore-amrwb \
            --disable-libdc1394 \
            --disable-libdirac \
            --disable-libfaac \
            --enable-libfaad \
            --disable-libfaadbin \
            --disable-libgsm \
            --disable-libmp3lame \
            --disable-libnut \
            --disable-libopenjpeg \
            --disable-libschroedinger \
            --disable-libspeex \
            --disable-libtheora \
            --disable-libvorbis \
            --disable-libx264 \
            --disable-libxvid \
            --disable-mlib \
            --enable-zlib \

make

$MAKEINSTALL
