#!/bin/sh
#
# configure and launch VDR
#
# runlevels: openelec, debug

(

  echo "### Starting VDR ###"

  PLUGINS=""
  for file in /storage/.config/vdr/plugins.d/*; do
    # plugins are enabled by default
    PLUGIN=""
    OPTIONS=""
    INITCMD=""
    ENABLED=yes
    . $file
    [ "$ENABLED" = yes ] && PLUGINS="$PLUGINS -P'$PLUGIN $OPTIONS'"
    [ -n "$INITCMD" ] && eval $INITCMD
  done

  VDRCMD="vdr -g /tmp -s /usr/bin/vdrshutdown --vfat --no-kbd $PLUGINS > /tmp/vdr.out 2>&1"

  # start VDR
  runvdr "$VDRCMD"
)&
