#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build zlib
$SCRIPTS/build libpng
$SCRIPTS/build $LIBJPEG
$SCRIPTS/build libX11
$SCRIPTS/build SDL
$SCRIPTS/build SDL_image
$SCRIPTS/build SDL_mixer
$SCRIPTS/build Mesa

ADDON_ID="addon.games.$1"
ADDON_VERSION="1"

PKG_DIR=`find $ROOT/$PACKAGES -type d -name $1`

cd $BUILD/$1/src

cd enet
  ./configure --host=$TARGET_NAME \
              --build=$HOST_NAME \

cd ..

make

cd ..

mkdir -p .addons/$ADDON_ID
  cp -R data .addons/$ADDON_ID
  cp -R packages .addons/$ADDON_ID
  cp *.cfg .addons/$ADDON_ID
  cp -R $PKG_DIR/scripts/* .addons/$ADDON_ID
  $SED "s|@ADDON_VERSION@|$OS_VERSION.$ADDON_VERSION|g" -i .addons/$ADDON_ID/addon.xml
  $SED "s|@ADDON_ID@|$ADDON_ID|g" -i .addons/$ADDON_ID/addon.xml

mkdir -p .addons/$ADDON_ID/bin
  cp src/sauer_client .addons/$ADDON_ID/bin
  cp src/sauer_server .addons/$ADDON_ID/bin

cd .addons
  zip -rq $ADDON_ID-$OS_VERSION.$ADDON_VERSION.zip $ADDON_ID
