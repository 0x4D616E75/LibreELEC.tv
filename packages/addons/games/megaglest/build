#!/bin/sh

. config/options

ADDON_NAME="plugin.games.$1"
ADDON_VERSION="1"

$SCRIPTS/build megaglest-source
$SCRIPTS/build megaglest-data

PKG_DIR=`find $ROOT/$PACKAGES -type d -name $1`

mkdir -p $BUILD/$1
cd $BUILD/$1

mkdir -p .addons/$ADDON_NAME
  cp $ROOT/$BUILD/$1-source*/glest.ini .addons/$ADDON_NAME
  cp -R $ROOT/$BUILD/$1-data*/* .addons/$ADDON_NAME

mkdir -p .addons/$ADDON_NAME/bin
  cp -R $ROOT/$BUILD/$1-source*/glest.bin .addons/$ADDON_NAME/bin
  cp -R $PKG_DIR/scripts/* .addons/$ADDON_NAME
  $SED "s|@ADDON_VERSION@|$OS_VERSION.$ADDON_VERSION|g" -i .addons/$ADDON_NAME/addon.xml

cd .addons
  zip -rq $ADDON_NAME-$OS_VERSION.$ADDON_VERSION.zip $ADDON_NAME
