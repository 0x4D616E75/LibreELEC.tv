#!/bin/sh

. config/options $1

ADDON_ID="addon.games.$1"
ADDON_VERSION="1"

$SCRIPTS/build megaglest-source
$SCRIPTS/build megaglest-data

mkdir -p $BUILD/$1
cd $BUILD/$1

mkdir -p .addons/$ADDON_ID
  cp $ROOT/$BUILD/$1-source*/glest.ini .addons/$ADDON_ID
  cp -R $ROOT/$BUILD/$1-data*/* .addons/$ADDON_ID

mkdir -p .addons/$ADDON_ID/bin
  cp -R $ROOT/$BUILD/$1-source*/glest.bin .addons/$ADDON_ID/bin
  cp -R $PKG_DIR/scripts/* .addons/$ADDON_ID
  $SED "s|@ADDON_VERSION@|$OS_VERSION.$ADDON_VERSION|g" -i .addons/$ADDON_ID/addon.xml
  $SED "s|@ADDON_ID@|$ADDON_ID|g" -i .addons/$ADDON_ID/addon.xml

cd .addons
  zip -rq $ADDON_ID-$OS_VERSION.$ADDON_VERSION.zip $ADDON_ID
