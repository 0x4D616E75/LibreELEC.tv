#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build alsa-lib
[ "$DEVTOOLS" = yes ] && $SCRIPTS/build ncurses

ALSAMIXER_CONFIG="--disable-alsamixer"
ALSATEST_CONFIG="--disable-alsatest"
[ "$DEVTOOLS" = yes ] && ALSAMIXER_CONFIG="--enable-alsamixer"
[ "$DEVTOOLS" = yes ] && ALSATEST_CONFIG="--enable-alsatest"

export CPPFLAGS="$CPPFLAGS -I$SYSROOT_PREFIX/usr/include/ncurses"
export LDFLAGS="$LDFLAGS -L$SYSROOT_PREFIX/usr/lib -L$SYSROOT_PREFIX/usr/lib64 -L$LIB_PREFIX/lib"

cd $PKG_BUILD
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-dependency-tracking \
            --disable-xmlto \
            $ALSAMIXER_CONFIG \
            $ALSATEST_CONFIG \
            --disable-nls

#sed -i -e 's/^\(man_MANS[ \t]*=[ \t]*\).*$/\1/' alsactl/Makefile.*

make -C amixer
make -C alsactl

if [ "$DEVTOOLS" = yes ]; then
  make -C alsamixer
  make -C aplay
  make -C iecset
  make -C speaker-test
fi

exit 0
