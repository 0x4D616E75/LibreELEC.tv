#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build alsa-lib
[ "$DEVTOOLS" = yes ] && $SCRIPTS/build ncurses

export CPPFLAGS="$CPPFLAGS -I$LIB_PREFIX/include/ncurses"
export LDFLAGS="$LDFLAGS -L$SYSROOT_PREFIX/usr/lib -L$SYSROOT_PREFIX/usr/lib64 -L$LIB_PREFIX/lib"

ALSAMIXER_CONFIG="--disable-alsamixer"
ALSATEST_CONFIG="--disable-alsatest"
ALSACONF_CONFIG="--disable-alsaconf"
[ "$DEVTOOLS" = yes ] && ALSAMIXER_CONFIG="--enable-alsamixer"
[ "$DEVTOOLS" = yes ] && ALSATEST_CONFIG="--enable-alsatest"
[ "$DEVTOOLS" = yes ] && ALSACONF_CONFIG="--enable-alsaconf"

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-dependency-tracking \
            $ALSAMIXER_CONFIG

sed -i -e 's/^\(man_MANS[ \t]*=[ \t]*\).*$/\1/' alsactl/Makefile.*

make -C amixer
make -C alsactl

if [ "$DEVTOOLS" = yes ]; then
  make -C alsamixer
  make -C alsaconf
  make -C aplay
  make -C iecset
  make -C speaker-test
fi

exit 0
