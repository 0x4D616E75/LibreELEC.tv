#!/bin/sh

. config/options $1

# ensure we dont use as-needed optimization.
  LDFLAGS=`echo $LDFLAGS | sed -e "s|-Wl,--as-needed||"`

if [ "$AVAHI_DAEMON" = yes ]; then
  PULSEAUDIO_AVAHI="--enable-avahi"
else
  PULSEAUDIO_AVAHI="--disable-avahi"
fi

cd $PKG_BUILD

$AUTORECONF

./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-static \
            --enable-shared \
            --disable-x11 \
            --disable-samplerate \
            --disable-oss-output \
            --disable-oss-wrapper \
            --enable-alsa \
            --disable-solaris \
            --disable-glib2 \
            --disable-gtk2 \
            --disable-gconf \
            $PULSEAUDIO_AVAHI \
            --disable-jack \
            --disable-lirc \
            --disable-hal \
            --enable-udev \
            --disable-hal-compat \
            --disable-bluez \
            --enable-dbus \
            --disable-ipv6 \
            --enable-openssl \
            --disable-manpages \
            --disable-per-user-esound-socket \
            --disable-legacy-runtime-dir \
            --with-system-user=root \
            --with-system-group=root \
            --with-access-group=root \
            --with-module-dir="/usr/lib/pulse" \

#            --with-system-user=pulse \
#            --with-system-group=pulse \
#            --with-access-group=pulse-access \

make

$MAKEINSTALL
